# Contributing to BugChan

This guide provides all the information you need to get started with local setup, understanding the project structure, managing environment variables, and following our development workflow.

## Monorepo Layout

The project is a Yarn monorepo, separating the on-chain and off-chain logic into two main packages:

-   `packages/hardhat` – Contains all Solidity smart contracts, deployment scripts, tests, and local blockchain configuration.
-   `packages/nextjs` – The complete Next.js frontend application, built with the App Router and leveraging Wagmi for blockchain interaction.

## Prerequisites

Before you begin, please ensure you have the following installed:

-   **Node.js:** v20.0 or higher.
-   **Yarn:** v3.x 
-   A Web3 wallet extension for your browser (e.g., MetaMask).

## 1. Initial Setup

Clone the repository and install all dependencies from the root directory.

```bash
git clone https://github.com/swarooppatilx/bug-chan.git
cd bug-chan
yarn install
```

## 2. Environment Configuration

You'll need to set up environment variables for both the Hardhat backend and the Next.js frontend.

#### Frontend (`packages/nextjs/.env.local`)

Copy the example file and fill in the required API keys.

```bash
cp packages/nextjs/.env.example packages/nextjs/.env.local
```

-   `NEXT_PUBLIC_LIGHTHOUSE_API_KEY`: **Required.** Your API key from [Lighthouse Storage](https://lighthouse.storage/) for uploading and managing encrypted reports on IPFS.
-   `NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID`: **Required.** Your project ID from [WalletConnect Cloud](https://cloud.walletconnect.com/).
-   `NEXT_PUBLIC_ALCHEMY_API_KEY`: **Required.** Your API key from [Alchemy](https://www.alchemy.com/) for connecting to Ethereum networks.

#### Backend (`packages/hardhat/.env`)

Copy the example file. The deployer key will be generated in the next step.

```bash
cp packages/hardhat/.env.example packages/hardhat/.env
```

-   `ALCHEMY_API_KEY`: **Required.** Your Alchemy API key (can be the same as the frontend one).
-   `ETHERSCAN_V2_API_KEY`: **Optional.** Your Etherscan API key, needed for contract verification on testnets/mainnet.
-   `DEPLOYER_PRIVATE_KEY_ENCRYPTED`: This will be generated automatically. **Do not fill this in manually.**

#### Generating Your Deployer Wallet

From the root of the project, run the `generate` script. You will be prompted to create a password, which will be used to encrypt your new wallet's private key.

```bash
yarn generate
```

This command creates a new deployer account and securely saves its encrypted private key to `packages/hardhat/.env`. **Remember your password!** You will need it every time you deploy to a live network.

You can also import an existing private key using `yarn account:import`.

## 3. Local Development Workflow

The local development process involves running three key components in separate terminals.

1.  **Start the Local Blockchain:**
    ```bash
    yarn chain
    ```
    This command starts a local Hardhat node, providing a simulated Ethereum environment for development and testing.

2.  **Deploy Smart Contracts:**
    ```bash
    yarn deploy
    ```
    This script compiles your smart contracts and deploys them to the local Hardhat node. Crucially, it also **automatically generates TypeScript ABI and address files** for the frontend, ensuring your UI is always in sync with your contracts.

3.  **Start the Frontend:**
    ```bash
    yarn start
    ```
    This starts the Next.js development server, accessible at `http://localhost:3000`. The frontend will automatically connect to your local Hardhat node.

## 4. Testing & Linting

-   **Run Smart Contract Tests:**
    ```bash
    yarn test
    ```
-   **Run Linters:**
    ```bash
    yarn lint
    ```
-   **Format Code:**
    ```bash
    yarn format
    ```

A pre-commit hook is configured with Husky to automatically lint and format your code before each commit.

## 5. Deploying to a Testnet

1.  **Fund Your Deployer Wallet:** Ensure the address generated by `yarn generate` has enough testnet ETH (e.g., Sepolia ETH) to pay for gas fees.
2.  **Run the Deploy Command:**
    ```bash
    yarn deploy --network sepolia
    ```
    You will be prompted for the password you created for your encrypted deployer key.
3.  **Commit the Contract Artifacts:** After a successful deployment, the `packages/nextjs/contracts/deployedContracts.ts` file will be updated with the new live contract addresses. **You must commit this updated file to your repository.** This ensures that your deployed frontend will interact with the correct contracts.

## 6. Hosting the Frontend (Vercel)

To deploy the frontend to Vercel, use the following configuration in your project settings:

-   **Root Directory:** `packages/nextjs`
-   **Build Command:** `yarn build`
-   **Install Command:** `yarn install`
-   **Environment Variables:** Add all the `NEXT_PUBLIC_*` variables from your `.env.local` file to the Vercel dashboard.

## Troubleshooting

-   **Missing Contracts on Frontend:** If the app shows errors about missing contracts, it means the frontend is out of sync with your deployments. Re-run `yarn deploy` (or `yarn deploy --network <chain>`) and ensure the `packages/nextjs/contracts/deployedContracts.ts` file is up to date.
-   **Wallet/Connection Issues:** Verify that your `NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID` and `NEXT_PUBLIC_ALCHEMY_API_KEY` are correct and that the RPC service is available.
-   **Lighthouse Upload Fails:** Ensure your `NEXT_PUBLIC_LIGHTHOUSE_API_KEY` is correctly set in `.env.local`. You must also approve the signature request from your wallet when prompted to authenticate with Lighthouse.
-   **Etherscan Verification Fails:** Make sure your `ETHERSCAN_V2_API_KEY` is set in `packages/hardhat/.env` and that the network you're deploying to is supported by Etherscan.